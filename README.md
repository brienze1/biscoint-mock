[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://github.com/brienze1/biscoint-mock/blob/main/LICENSE)
![GitHub tag (latest by date)](https://img.shields.io/github/v/tag/brienze1/biscoint-mock)
![Build](https://img.shields.io/github/workflow/status/brienze1/biscoint-mock/Build?label=Build)
[![codecov](https://codecov.io/gh/brienze1/biscoint-mock/branch/main/graph/badge.svg?token=Z6DSMJ621I)](https://codecov.io/gh/brienze1/biscoint-mock)

# Biscoint Mock

<div id="top"></div>

1. [About the Project](#about-the-project)
    1. [Input](#input)
        1. [Create Offer Input](#create-offer-input)
        2. [Confirm Offer Input](#confirm-offer-input)
        3. [Generate Token Input](#generate-token-input)
    2. [Output](#output)
        1. [Create Offer Output](#create-offer-output)
        2. [Confirm Offer Output](#confirm-offer-output)
        3. [Generate Token Output](#generate-token-output)
    3. [Rules](#rules)
    4. [Built With](#built-with)
        1. [Dependencies](#dependencies)
        2. [Test Dependencies](#test-dependencies)
        3. [Plugins](#plugins)
    5. [Roadmap](#roadmap)
2. [Getting Started](#getting-started)
    1. [Prerequisites](#prerequisites)
    2. [Installation](#installation)
    3. [Requirements](#requirements)
        1. [Deploying Local Infrastructure](#deploying-local-infrastructure)
    4. [Usage](#usage)
        1. [Manual Input](#manual-input)
        2. [Docker Input](#docker-input)
    5. [Testing](#testing)
3. [About Me](#about-me)

## About the Project

The objective of this application is to implement a crypto API to create and confirm offers,
simulating [Biscoint](https://biscoint.io/docs/api) APIs.

### Input

The process is triggered via rest endpoints. There are three routes available.

#### Create Offer Input

Offers can be generated by sending a `POST` request at `v1/offer`. The required data input can be seen bellow.

- op: can be `buy` or `sell`
- amount: is the amount intended for the offer
- isQuote: refers if the offer amount is quoted in `BTC` or `BRL`

```json
{
  "op": "sell",
  "amount": "0.00908964",
  "isQuote": false
}
```

And there is also some headers that need to be sent:

- BSCNT-NONCE: random positive number
- BSCNT-APIKEY: client api_key stored in client db
- BSCNT-SIGN: auth token generated

```headers
BSCNT-NONCE:1580390222668002
BSCNT-APIKEY:3ddc931bf25c94ff0344a2e409aa37339e400b8d4da72265f97c3a31d0cfb36e
BSCNT-SIGN:92d9cf2b82780e86aa117956ec725c119490657b8e97132144f062bade949a8185e22881ba12a247eb9594d8397d64e4
```

#### Confirm Offer Input

Offers can be confirmed by sending a `POST` request at `v1/offer/confirm`. The required data input can be seen bellow.

- offerId: the id generated by the `v1/offer` endpoint

```json
{
  "offerId": "07ccab5b-7180-4149-8978-dadd246e92c9"
}
```

And there is also some headers that need to be sent:

- BSCNT-NONCE: random positive number
- BSCNT-APIKEY: client api_key stored in client db
- BSCNT-SIGN: auth token generated

```headers
BSCNT-NONCE:1580390222668002
BSCNT-APIKEY:3ddc931bf25c94ff0344a2e409aa37339e400b8d4da72265f97c3a31d0cfb36e
BSCNT-SIGN:92d9cf2b82780e86aa117956ec725c119490657b8e97132144f062bade949a8185e22881ba12a247eb9594d8397d64e4
```

#### Generate Token Input

Tokens can be generated by sending a `POST` request at `v1/auth`. The required data input needs to be the same one that
will be used in the request authenticated by the generated token.

Some headers need to be sent:

- BSCNT-NONCE: random positive number
- BSCNT-APIKEY: client api_key stored in client db
- BSCNT-PATH: path where the token is going to be used

```headers
BSCNT-NONCE:1580390222668002
BSCNT-APIKEY:3ddc931bf25c94ff0344a2e409aa37339e400b8d4da72265f97c3a31d0cfb36e
BSCNT-PATH:v1/offer/confirm
```

### Output

#### Create Offer Output

The output generated by calling `v1/offer` can be seen bellow.

- offerId: the offer id generated
- efPrice: current unitary price of BTC
- expiresAt: time on witch the offer will be expired and cannot be confirmed anymore

```json
{
  "message": "",
  "data": {
    "offerId": "37e15290-e457-4ae2-81d9-c6d1b4b45b8f",
    "base": "BTC",
    "quote": "BRL",
    "op": "sell",
    "isQuote": false,
    "baseAmount": 0.00908964,
    "quoteAmount": 949.07,
    "efPrice": 104412.58,
    "createdAt": "2022-09-14T14:22:26.230447",
    "expiresAt": "2022-09-14T14:22:41.230462",
    "apiKeyId": "3ddc931bf25c94ff0344a2e409aa37339e400b8d4da72265f97c3a31d0cfb36e"
  }
}
```

#### Confirm Offer Output

The output generated by calling `v1/offer/confirm` can be seen bellow.

- offerId: the offer id generated
- efPrice: current unitary price of BTC
- confirmedAt: time on witch the offer was confirmed

```json
{
  "message": "",
  "data": {
    "offerId": "fa9149bd-f73b-4298-a1c2-70a3e1720d4e",
    "base": "BTC",
    "quote": "BRL",
    "op": "sell",
    "isQuote": false,
    "baseAmount": 0.00908964,
    "quoteAmount": 949.07,
    "efPrice": 104412.03,
    "createdAt": "2022-09-14T14:24:19.742134",
    "confirmedAt": "2022-09-14T14:24:27.779686",
    "apiKeyId": "3ddc931bf25c94ff0344a2e409aa37339e400b8d4da72265f97c3a31d0cfb36e"
  }
}
```

#### Generate Token Output

The output generated by calling `v1/auth` can be seen bellow.

- token: the token generated to be used as authentication in the header of the other routes

```json
{
  "token": "92d9cf2b82780e86aa117956ec725c119490657b8e97132144f062bade949a8185e22881ba12a247eb9594d8397d64e4"
}
```

### Rules

Here are some rules that need to be implemented in this application.

Implemented:

- Client has to have balance to create and confirm offers
- Offers expired cannot be confirmed
- Balance will be recalculated after offer confirmation
- All paths, with exception to `v1/auth`, need to be authenticated

### Built With

This application is build with Java with Spring Boot framework. Code is tested, build and a Dockerfile image is sent
to Docker HUB every push made into the main branch using GitHub actions.

The project was created using Clean Architecture and is divided into 4 modules:

* Application -> Project bean configuration and application properties
* Delivery -> Composes the controller endpoints that triggers the process and also error handlers
* Domain -> Responsible for the domain rules and models
* Integration -> Responsible for the integration with the external infrastructure (DB, Biscoint API)

#### Dependencies

* [Spring Boot](https://spring.io/projects/spring-boot) Used as framework for application
* [Spring Web](https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web): Used to create
  Rest endpoints
* [Spring Data](https://spring.io/projects/spring-data) Used to integrate web related dependencies for API calls
* [H2](https://www.h2database.com/html/main.html) Used to integrate web related dependencies for API calls
* [Commons Codec](https://commons.apache.org/proper/commons-codec/) Used to encrypt the authorization token

#### Test Dependencies

* [Junit4](https://github.com/junit-team/junit4): Used to run integration tests
* [Cucumber](https://cucumber.io/docs/installation/java/): Used to integrate Gherkin with Java and run integration tests
* [Spring Test](https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-test): Spring test
  dependencies

#### Plugins

* [Spring Boot Maven Plugin](https://docs.spring.io/spring-boot/docs/current/maven-plugin/reference/htmlsingle/): Used
  to package spring boot application into runnable jar
* [Maven Surefire Plugin](https://maven.apache.org/surefire/maven-surefire-plugin/): Used to configure test logs
* [Maven Failsafe Plugin](https://maven.apache.org/surefire/maven-failsafe-plugin/): Used to configure tests
* [Jacoco Plugin](https://www.jacoco.org/jacoco/): Used to generate coverage reports

### Roadmap

* [X] Implement Behaviour tests (BDD) with cucumber
* [ ] Implement Unit tests
* [X] Implement application logic
* [X] Add maven wrapper to run mvn commands locally
* [ ] Create Dockerfile
* [ ] Document everything in Readme
* [ ] Add logger lib and logs

<p style="text-align: right">(<a href="#top">back to top</a>)</p>

## Getting Started

### Prerequisites

- Install version 18 of the JDK
    - [Manual](https://adoptium.net/?variant=openjdk18)
    - [IntelliJ](https://www.jetbrains.com/help/idea/sdk.html#jdk)
    - [Homebrew](https://docs.brew.sh/Installation)
      ```bash
      brew install openjdk@18
      ```

- Set the `JAVA_HOME` environment variable to the path where your JDK is located
    - [Windows](https://confluence.atlassian.com/doc/setting-the-java_home-variable-in-windows-8895.html)
    - macOS/Linux/WSL
      ```bash
      echo 'export JAVA_HOME=/path/to/jdk' >> ~/.bashrc 
      ```

- Install Docker (Optional)
    - [Windows/macOS/Linux/WSL](https://www.docker.com/get-started/)

### Installation

- Run the following to install dependencies and compile the project:
    - Windows
      ```bash
      mvnw.bat clean install
      ```
    - macOS/Linux/WSL
      ```bash
      ./mvnw clean install
      ```

### Usage

#### Manual Input

- Start the compiled application:
    - Windows/macOS/Linux/WSL
      ```bash
      java -jar ./application/target/biscoint-mock.jar
      ```

- Send requests using external tools ([postman](https://www.postman.com/) for example)
- To stop the application just press Ctrl+C

#### Docker Input

- In case you want to use a Docker container to run the application first you need to build the Docker image from
  Dockerfile:
- Note: This may take a while to build (close to 5 min)
    - Windows/macOS/Linux/WSL
      ```bash
      docker build -t biscoint-mock .
      ```

- And then run the new created image:
    - Windows/macOS/Linux/WSL
      ```bash
      docker run --network="host" -d -it -e SPRING_PROFILES_ACTIVE=docker biscoint-mock:latest bash -c \
      "java -jar application/target/biscoint-mock.jar"
      ```

### Testing

- To run the tests just type the command bellow in terminal:
    - Windows
      ```bash
      mvnw.bat test
      ```
    - macOS/Linux/WSL
      ```bash
      ./mvnw test
      ```

### Known issues

- docker error command not found "\r", fix:
    - Open your shell file on NotePad++
    - Click on Edit on Top bar menu, then choose EOL Conversion --> Unix(LF)
    - Save the file.

<p style="text-align: right">(<a href="#top">back to top</a>)</p>

## About me

Hello! :)

My name is Luis Brienze, and I'm a Software Engineer.

I focus primarily on software development, but I'm also good at system architecture, mentoring other developers,
etc... I've been in the IT industry for 4+ years, during this time I worked for companies like Itau, Dock, Imagine
Learning and
EPAM.

I graduated from UNESP studying Automation and Control Engineering in 2022, and I also took multiple courses on Udemy
and Alura.

My main stack is Java, but I'm also pretty good working with Kotlin and TypeScript (both server side).
I have quite a good knowledge of AWS Cloud, and I'm also very conformable working with Docker.

During my career, while working with QA's, I've also gained alot of valuable experience with testing applications in
general from unit/integrated
testing using TDD and BDD, to performance testing apps with JMeter for example.

If you want to talk to me, please fell free to reach me anytime at [LinkedIn](https://www.linkedin.com/in/luisbrienze/)
or [email](lfbrienze@gmail.com).

<p style="text-align: right">(<a href="#top">back to top</a>)</p>